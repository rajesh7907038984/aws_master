{% if branches and branches.count > 0 %}
<div class="bg-white p-4 mb-6 rounded-lg shadow-sm">
    <div class="flex flex-col md:flex-row md:items-center gap-4">
        <div class="font-medium text-gray-700">Branch Filter:</div>
        <div class="flex-1">
            <select id="branch-filter" class="form-select w-full md:w-auto rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                {% if user.is_superuser or user.role == 'globaladmin' or user.role == 'superadmin' %}
                <option value="all">All Branches</option>
                {% endif %}
                {% for branch in branches %}
                <option value="{{ branch.id }}" {% if branch.id == selected_branch_id %}selected{% endif %}>
                    {{ branch.name }}
                    {% if user.role == 'globaladmin' and branch.business %}
                    ({{ branch.business.name }})
                    {% endif %}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const branchFilter = document.getElementById('branch-filter');
        
        branchFilter.addEventListener('change', function() {
            // Get current URL
            const url = new URL(window.location.href);
            
            // Update the branch parameter
            if (this.value === 'all') {
                url.searchParams.delete('branch');
            } else {
                url.searchParams.set('branch', this.value);
            }
            
            // Redirect to the new URL
            window.location.href = url.toString();
        });
    });
</script>
{% endif %} 