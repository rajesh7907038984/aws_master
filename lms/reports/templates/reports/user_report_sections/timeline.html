{% extends 'reports/user_report_sections/base.html' %}
{% load static %}

{% block section_content %}
<div class="mb-6">
    <h2 class="text-xl font-semibold mb-2">User Activity Timeline</h2>
    <p class="text-gray-500 text-sm">Showing the most recent activity events for {{ user.get_full_name|default:user.username }}</p>
</div>

<!-- Timeline View -->
<div id="timeline-container" class="relative pl-8 border-l-2 border-gray-200 ml-6 space-y-10">
    {% for activity in user_activities %}
    <div class="relative timeline-item">
        <!-- Date marker -->
        <div class="absolute -left-10 mt-1.5 w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center">
            <i class="fas fa-check text-white text-xs"></i>
        </div>
        
        <!-- Activity card -->
        <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex items-start">
                <div class="flex-grow">
                    <div class="text-xs text-gray-500 mb-1">{{ activity.created_at|date:"d/m/Y H:i" }}</div>
                    <div class="font-medium">
                        {{ activity.get_type_display }}
                        {% if activity.course %}
                            - {{ activity.course.title }}
                        {% endif %}
                    </div>
                    {% if activity.description %}
                    <div class="text-sm text-gray-600 mt-1">
                        {{ activity.description }}
                    </div>
                    {% endif %}
                </div>
                <div class="text-{% if activity.type == 'LOGIN' %}blue{% elif activity.type == 'COURSE_COMPLETE' %}green{% elif activity.type == 'ASSIGNMENT_SUBMIT' %}purple{% elif activity.type == 'QUIZ_TAKE' %}orange{% else %}gray{% endif %}-500 ml-4">
                    <i class="fas fa-{% if activity.type == 'LOGIN' %}sign-in-alt{% elif activity.type == 'COURSE_START' %}play{% elif activity.type == 'COURSE_COMPLETE' %}check-circle{% elif activity.type == 'ASSIGNMENT_SUBMIT' %}file-upload{% elif activity.type == 'QUIZ_TAKE' %}question-circle{% elif activity.type == 'FORUM_POST' %}comment{% elif activity.type == 'RESOURCE_VIEW' %}eye{% else %}star{% endif %} text-xl"></i>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="py-6 text-center" id="no-activities-message">
        <div class="text-gray-400 mb-2"><i class="fas fa-history text-4xl"></i></div>
        <p class="text-gray-500">No activity data available</p>
    </div>
    {% endfor %}
</div>

<!-- Load More Button -->
<div class="mt-6 text-center" id="load-more-container" {% if not user_activities %}style="display: none;"{% endif %}>
    <button id="load-more-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition-all" data-offset="20">
        <span class="load-more-text">Load More</span>
        <span class="load-more-spinner" style="display: none;">
            <i class="fas fa-spinner fa-spin mr-2"></i>Loading...
        </span>
    </button>
</div>
{% endblock %}
